{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Productos</title>
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
</head>
<body>
<div class="container mt-5">
    <h2>Gestión de productos</h2>
    <!-- Formulario para agregar/editar producto -->
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="producto_id" value="{{ producto_editar.id|default:'' }}">
        <div class="mb-3">
            <label>Nombre</label>
            <input type="text" name="nombre" class="form-control" required value="{{ producto_editar.nombre|default:'' }}">
        </div>
        <div class="mb-3">
            <label>Descripción</label>
            <textarea name="descripcion" class="form-control" required>{{ producto_editar.descripcion|default:'' }}</textarea>
        </div>
        <div class="mb-3">
            <label>Precio</label>
            <input type="number" step="0.01" name="precio" class="form-control" required value="{{ producto_editar.precio|default:'' }}">
        </div>
        <div class="mb-3">
            <label>Stock</label>
            <input type="number" name="stock" class="form-control" required value="{{ producto_editar.stock|default:'' }}">
        </div>
        <div class="mb-3">
            <label>Categoría</label>
            <input type="text" name="categoria" class="form-control" required value="{{ producto_editar.categoria|default:'' }}">
        </div>
        <div class="mb-3">
            <label>Marca</label>
            <input type="text" name="marca" class="form-control" required value="{{ producto_editar.marca|default:'' }}">
        </div>
        <div class="mb-3">
            <label>Imagen</label>
            <input type="file" name="imagen" class="form-control">
            {% if producto_editar.imagen %}
                <img src="{{ producto_editar.imagen }}" alt="Imagen actual" style="max-width:100px;margin-top:10px;">
            {% endif %}
        </div>
        {% if producto_editar and producto_editar.imagen %}
            <input type="hidden" name="imagen_actual" value="{{ producto_editar.imagen }}">
        {% endif %}
        <button type="submit" class="btn btn-primary">{% if producto_editar %}Actualizar{% else %}Guardar{% endif %}</button>
        <a href="{% url 'index' %}" class="btn btn-secondary">Volver a Inicio</a>
    </form>

    <hr>
    <h4>Productos existentes</h4>
    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Precio</th>
                <th>Stock</th>
                <th>Categoría</th>
                <th>Marca</th>
                <th>Imagen</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
        {% for producto in productos %}
            <tr>
                <td>{{ producto.nombre }}</td>
                <td>{{ producto.descripcion }}</td>
                <td>${{ producto.precio }}</td>
                <td>{{ producto.stock }}</td>
                <td>{{ producto.categoria }}</td>
                <td>{{ producto.marca }}</td>
                <td>
                    {% if producto.imagen %}
                        <img src="{{ producto.imagen }}" alt="img" style="max-width:60px;">
                    {% endif %}
                </td>
                <td>
    <form method="post" style="display:inline;">
        {% csrf_token %}
        <input type="hidden" name="edit_id" value="{{ producto.id }}">
        <button type="submit" class="btn btn-sm btn-warning">Editar</button>
    </form>
    <form method="post" style="display:inline;" onsubmit="return confirm('¿Seguro que deseas eliminar este producto?');">
        {% csrf_token %}
        <input type="hidden" name="delete_id" value="{{ producto.id }}">
        <button type="submit" class="btn btn-sm btn-danger">Eliminar</button>
    </form>
</td>
            </tr>
        {% empty %}
            <tr><td colspan="8">No hay productos registrados.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>
</body>
</html>

{% block scripts %}
<script>
    // Aquí puedes agregar scripts adicionales si es necesario
</script>
{% endblock %}